<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>新聞管理後台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-5">
    <div class="container bg-white p-4 shadow rounded" style="max-width: 600px;">
        <h3 class="mb-4">發布最新消息</h3>
        <div class="mb-3">
            <label class="form-label">新聞標題</label>
            <input type="text" id="title" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">內容</label>
            <textarea id="content" class="form-control" rows="5"></textarea>
        </div>
        <div class="mb-3">
            <label class="form-label">上傳圖片 (選填)</label>
            <input type="file" id="image" class="form-control" accept="image/*">
        </div>
        <button onclick="publish()" id="pubBtn" class="btn btn-primary w-100">立即發布</button>
    </div>

    <script>
        async function publish() {
            const btn = document.getElementById('pubBtn');
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            const imageFile = document.getElementById('image').files[0];

            if(!title || !content) return alert('請填寫完整');

            btn.disabled = true;
            btn.innerText = '處理中...';

            const formData = new FormData();
            formData.append('title', title);
            formData.append('content', content);
            if(imageFile) formData.append('image', imageFile);

            try {
                const res = await fetch('/api/news', {
                    method: 'POST',
                    body: formData // 注意：使用 FormData 時不要設定 Content-Type header
                });
                if(res.ok) {
                    alert('發布成功！');
                    location.reload();
                } else {
                    alert('失敗：' + await res.text());
                }
            } catch(e) {
                alert('系統錯誤');
            } finally {
                btn.disabled = false;
                btn.innerText = '立即發布';
            }
        }
    </script>
</body>
</html>
